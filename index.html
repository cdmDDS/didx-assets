<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>DIDx Reporting Tool</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- =========================
HTML (JSFiddle HTML panel)
========================= -->
<div class="app">
  <header class="topbar">
    <div class="brand">
      <div class="dot"></div>
      <div>
        <div class="title">DIDx Reporting</div>
        <div class="subtitle">Manual UID worklist (no API)</div>
      </div>
    </div>

    <div class="actions">
      <div class="topActions">
        <div class="tabs tabs--top">
          <button id="tabPending" class="tab active" type="button">
            Pending
          </button>
          <button id="tabCompleted" class="tab" type="button">Completed</button>
        </div>

        <button id="btnClearAll" class="btn btn-ghost" type="button">
          Clear
        </button>
        <button id="btnLoadDemo" class="btn btn-ghost">Load demo UIDs</button>
      </div>
    </div>
  </header>
  <div class="userbar">
    <span class="muted">Signed in:</span>
    <select id="selUser" class="sel sel-mini"></select>
  </div>
</div>

<main class="grid">
  <!-- LEFT: WORKLIST -->
  <section class="panel" id="worklistPanel">
    <div class="panel-header">
      <div
        style="
          display: flex;        
          align-items: flex-start;
          justify-content: space-between;
          gap: 12px;
        "
      >
        <div>
          <h2>Worklist</h2>
          <div id="worklistSubtitle" class="hint">Pending</div>
        </div>
        <div class="wlSearch">
          <label for="wlSearchInput" class="wlSearchLabel">Search:</label>
          <input
            id="wlSearchInput"
            class="wlSearchInput"
            type="text"
            placeholder="Type UID, name, DOB, dateâ€¦"
            autocomplete="off"
          />
          <button
            id="wlSearchClear"
            class="wlSearchClear"
            type="button"
            title="Clear"
          >
            âœ•
          </button>
        </div>

        <button id="btnOpenAddCase" class="btn btn-primary">Add Caseâ€¦</button>
      </div>
    </div>

    <div class="worklist-tools" id="worklistTools" style="display: none">
      <div class="line2">
        <span class="muted">Cases assigned to:</span>
        <select id="selAssignedFilter" class="sel"></select>
      </div>
    </div>

    <div id="worklist" class="worklist"></div>
  </section>

  <!-- RIGHT: REPORT -->
  <section class="panel" id="reportPanel">
    <div class="panel-header reportHeader">
  <div class="reportHeaderLeft">
    <!-- NEW wrapper so title + subhead stack vertically -->
    <div class="reportHeaderStack">
      <h2>Report</h2>
      <div id="reportSubhead" class="hint reportSubhead"></div>
    </div>
  </div>

      <div class="reportHeaderRight">
        <button
          id="btnAddAddendum"
          class="btn btn-ghost"
          type="button"
          disabled
        >
          Add Addendum
        </button>
        <button id="btnFinalize" class="btn btn-final" type="button" disabled>
          Finalize report
        </button>
        <button id="btnUnfinalize" class="btn btn-ghost" type="button" disabled>
          Unfinalize
        </button>
        <button
          id="btnExportPdf"
          class="btn btn-primary"
          type="button"
          disabled
        >
          Export PDF
        </button>
      </div>
    </div>

    <div id="reportPane" class="reportPane">
      <div class="reportCard">
        <!-- Top metadata block -->
        <div class="reportTop">
          <div class="row">
            <label class="lbl-inline">Study Details:</label>
            <div class="combo" id="comboStudyDetails">
              <input
                id="selStudyDetails"
                class="comboInput"
                type="text"
                placeholder="â€”"
                autocomplete="off"
              />
              <button class="comboBtn" type="button" aria-label="Open list">
                â–¾
              </button>
              <div class="comboMenu" id="menuStudyDetails" role="listbox"></div>
            </div>
            <span class="fovText">field of view CBCT extending from:</span>
          </div>

          <div class="row fovRow">
            <div class="combo" id="comboFrom">
              <input
                id="selFrom"
                class="comboInput"
                type="text"
                placeholder="(superior extent)"
                autocomplete="off"
              />
              <button class="comboBtn" type="button" aria-label="Open list">
                â–¾
              </button>
              <div class="comboMenu" id="menuFrom" role="listbox"></div>
            </div>

            <span class="pill">to</span>

            <div class="combo" id="comboTo">
              <input
                id="selTo"
                class="comboInput"
                type="text"
                placeholder="(inferior extent)"
                autocomplete="off"
              />
              <button class="comboBtn" type="button" aria-label="Open list">
                â–¾
              </button>
              <div class="comboMenu" id="menuTo" role="listbox"></div>
            </div>
          </div>

          <div class="row">
            <label class="lbl-inline">History:</label>
            <textarea
              id="txtHistory"
              class="inlineTA"
              rows="1"
              placeholder="â€”"
            ></textarea>
          </div>

          <div class="row">
            <label class="lbl-inline">Indications:</label>
            <textarea
              id="txtIndications"
              class="inlineTA"
              rows="1"
              placeholder="â€”"
            ></textarea>
          </div>

          <div class="row">
            <label class="lbl-inline">Add Ons:</label>
            <button id="btnAddOn" class="btn btn-ghost" type="button">
              Select...
            </button>
            <div id="addOnPills" class="pillWrap"></div>
          </div>

          <div class="row col">
            <label class="lbl">Note from referring doctor:</label>
            <textarea
              id="txtRefNote"
              class="textbox textbox-sm"
              placeholder="Enter note (not included in exported PDF)..."
            ></textarea>
          </div>
        </div>

        <!-- Autosave row (AI sort stays here) -->

        <div id="toast" class="toast" aria-live="polite"></div>

        <!-- Editor -->
        <div class="editor">
          <div class="lblRow">
            <label class="lbl" style="margin: 0">Dictation Box</label>
            <div class="spacer"></div>
            <button id="btnAiSort" class="btn btn-ai" type="button" disabled>
              AI Sort
            </button>
          </div>

          <textarea
            id="txtDictation"
            class="textbox"
            placeholder="Paste/enter dictation here (not exported)..."
          ></textarea>

          <label class="lbl">Impression</label>
          <textarea
            id="txtImpression"
            class="textbox bulletbox"
            placeholder="Impression..."
          ></textarea>

          <label class="lbl">Dentoalveolar</label>
          <textarea
            id="txtDentoalveolar"
            class="textbox bulletbox"
            placeholder="Findings..."
          ></textarea>

          <label class="lbl">Occlusion</label>
          <textarea
            id="txtOcclusion"
            class="textbox bulletbox"
            placeholder="Findings..."
          ></textarea>

          <label class="lbl">TMJs</label>
          <textarea
            id="txtTMJs"
            class="textbox bulletbox"
            placeholder="Findings..."
          ></textarea>

          <label class="lbl">Paranasal Sinuses</label>
          <textarea
            id="txtSinuses"
            class="textbox bulletbox"
            placeholder="Findings..."
          ></textarea>

          <label class="lbl">Airway</label>
          <textarea
            id="txtAirway"
            class="textbox bulletbox"
            placeholder="Findings..."
          ></textarea>

          <label class="lbl">Cervical Spine</label>
          <textarea
            id="txtCSpine"
            class="textbox bulletbox"
            placeholder="Findings..."
          ></textarea>

          <label class="lbl">Other Findings</label>
          <textarea
            id="txtOther"
            class="textbox bulletbox"
            placeholder="Findings..."
          ></textarea>

          <div class="divider"></div>

          <!-- Screenshots -->
          <div class="shotHeader">
            <div>
              <div class="shotTitle">Screenshots</div>
              <div class="hint">
                Click the box, paste (Ctrl+V). Title popup opens. Drag cards to
                reorder.
              </div>
            </div>

            <div class="shotActions">
              <button
                id="btnUploadShot"
                class="btn btn-ghost"
                type="button"
                disabled
              >
                Upload screenshot
              </button>

              <input
                id="fileShot"
                type="file"
                accept="image/*"
                style="display: none"
              />

              <button
                id="btnClearShots"
                class="btn btn-ghost"
                type="button"
                disabled
              >
                Clear screenshots
              </button>
            </div>
          </div>

          <div
            id="shotDrop"
            class="shotDrop"
            tabindex="0"
            aria-label="Screenshot paste area"
          >
            <div class="shotDropInner">
              <div class="shotIcon">ðŸ“‹</div>
              <div>
                <div class="shotDropText">
                  Click here, then paste your screenshot
                </div>
                <div class="hint">
                  Stored locally in your browser (per UID) for this prototype.
                </div>
              </div>
            </div>
          </div>

          <!-- Hidden paste catcher -->
          <textarea
            id="shotPasteCatcher"
            style="
              position: fixed;
              left: -9999px;
              top: -9999px;
              width: 1px;
              height: 1px;
              opacity: 0;
            "
            aria-hidden="true"
          ></textarea>

          <div id="shotList" class="shotList"></div>

          <div class="divider"></div>

          <details class="details">
            <summary>Case details</summary>
            <pre id="caseDetails" class="pre"></pre>
          </details>
        </div>
      </div>
    </div>
  </section>

  <!-- Add Case Modal -->
  <div class="modal" id="addCaseModal" aria-hidden="true">
    <div class="modalCard">
      <div class="modalTitle">Add Case</div>
      <div class="hint" style="margin-top: 6px">
        Copy/paste case info. Required fields marked <span class="req">*</span>
      </div>

      <div class="modalBody" style="margin-top: 12px">
        <label class="lbl2">UID <span class="req">*</span></label>
        <input id="inUid" class="inlineInput" placeholder="UID-XXXX" />
        <label class="lbl2">Submission Date<span class="req">*</span></label>
        <input id="inSubmittedDate" type="date" class="inlineInput" />

        <label class="lbl2"
          >Patient (Last, First) <span class="req">*</span></label
        >
        <input
          id="inPatient"
          class="inlineInput"
          placeholder="Lastname,Firstname"
        />

        <label class="lbl2">DOB (YYYY-MM-DD) <span class="req">*</span></label>
        <input id="inDob" class="inlineInput" placeholder="YYYY-MM-DD" />

        <label class="lbl2">Study Date<span class="req">*</span></label>
        <input id="inStudyDate" type="date" class="inlineInput" />

        <label class="lbl2">Race</label>
        <input id="inRace" class="inlineInput" placeholder="Optional" />

        <label class="lbl2">History <span class="req">*</span></label>
        <textarea
          id="inHistory"
          class="textbox"
          style="min-height: 90px"
        ></textarea>

        <label class="lbl2">Indications <span class="req">*</span></label>
        <textarea
          id="inIndications"
          class="textbox"
          style="min-height: 90px"
        ></textarea>

        <label class="lbl2">Medical History</label>
        <textarea
          id="inMedHx"
          class="textbox"
          style="min-height: 90px"
        ></textarea>

        <label class="lbl2">Assign to Radiologist</label>
        <select id="selAssignTo" class="sel"></select>
      </div>

      <div class="modalRow">
        <button id="btnCancelAddCase" class="btn btn-ghost" type="button">
          Cancel
        </button>
        <button id="btnClearIntake" class="btn btn-ghost" type="button">
          Clear
        </button>
        <button id="btnAddToWorklist" class="btn btn-primary" type="button">
          Add to Worklist
        </button>
      </div>
    </div>
  </div>

  <!-- Multi-select popover -->
  <div id="addOnPop" class="pop" aria-hidden="true">
    <div class="popCard">
      <div class="popTitle">Add Ons</div>
      <div id="addOnList" class="popList"></div>
      <div class="popRow">
        <button id="btnAddOnClose" class="btn btn-ghost" type="button">
          Done
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: screenshot title + preset dropdown -->
  <div id="modal" class="modal" aria-hidden="true">
    <div
      class="modalCard"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
    >
      <div class="modalTitle" id="modalTitle">Add screenshot title</div>
      <div class="modalBody">
        <input
          id="modalInput"
          class="modalInput"
          type="text"
          placeholder="Type title..."
        />

        <div class="combo comboModal" id="comboShotPreset">
          <input
            id="modalPreset"
            class="comboInput"
            type="text"
            placeholder="â€” Or choose a preset title â€”"
            autocomplete="off"
          />
          <button class="comboBtn" type="button" aria-label="Open presets">
            â–¾
          </button>
          <div class="comboMenu" id="menuShotPreset" role="listbox"></div>
        </div>

        <div class="hint" style="margin-top: 6px">
          Enter = Save â€¢ Esc = Cancel
        </div>
      </div>
      <div class="modalRow">
        <button id="modalCancel" class="btn btn-ghost" type="button">
          Cancel
        </button>
        <button id="modalSave" class="btn btn-primary" type="button">
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: addendum -->
  <div id="addendumModal" class="modal" aria-hidden="true">
    <div
      class="modalCard"
      role="dialog"
      aria-modal="true"
      aria-labelledby="addendumTitle"
    >
      <div class="modalTitle" id="addendumTitle">Add Addendum</div>
      <div class="modalBody">
        <textarea
          id="addendumText"
          class="textbox textbox-sm"
          placeholder="Enter addendum text..."
        ></textarea>
        <div class="hint" style="margin-top: 6px">
          Enter = Save â€¢ Esc = Cancel
        </div>
      </div>
      <div class="modalRow">
        <button id="addendumCancel" class="btn btn-ghost" type="button">
          Cancel
        </button>
        <button id="addendumSave" class="btn btn-primary" type="button">
          Save addendum
        </button>
      </div>
    </div>
  </div>
  <!-- Global Paste Catcher -->
  <textarea
    id="pasteCatcher"
    aria-hidden="true"
    tabindex="-1"
    style="
      position: fixed;
      left: -9999px;
      top: 0;
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
    "
  ></textarea>
</main>
<script src="./app.js"></script>
  </body>
</html>
